\documentclass{article}
\usepackage{amsmath}
\usepackage{braket}

\makeatletter
\newcommand\E{\@ifnextchar[{\@with}{\@without}}
\def\@with[#1]#2{E_{#2}^{(#1)}}
\def\@without#1{E_{#1}}
\makeatother

\makeatletter
\newcommand\footnoteref[1]{\protected@xdef\@thefnmark{\ref{#1}}\@footnotemark}
\makeatother

\begin{document}
\section{Total Energy for GFN2-xTB}
\begin{equation}
\begin{split}
\E{GFN2-xTB} &= \E[0]{rep}+\E[0,1,2]{disp}+\E[1]{EHT}+\E[2]{IES+IXC}+\E[2]{AES+AXC}+\E[3]{IES+IXC}\\
&=\E{rep}+\E{disp}^{D4'}+\E{EHT}+\E{\gamma}+\E{AES}+\E{AXC}+\E{\Gamma}^{GFN2}
\end{split}
\end{equation}
\subsection{Repulsion Energy}
\begin{align}
\E{rep} &= \frac{1}{2}\sum_{A,B}\frac{Z^{eff}_A Z^{eff}_B}{R_{AB}}e^{-\sqrt{a_Aa_B}(R_{AB})^{(k_f)}}\\
k_f &= \begin{cases}1 & if A,B\in\{\text{H},\text{He}\}\\\frac{3}{2}&otherwise\end{cases} 
\end{align}
$Z^{eff}$ and $a$ are variables fitted for each element. A,B are the labels of atoms. 
Since we only have C and H in our systems we can simplify this quite a bit in code. 
$R_{AB}$ is the distance between the A and B atoms.
\subsection{Extended Hückel Theory Energy}
\begin{equation}
\E{EHT} = \sum_{\mu\nu}P_{\mu\nu}H^{EHT}_{\mu\nu}
\end{equation}
where $\mu$ and $\nu$ are AO indecies, $l$ and $l'$ index shells. Both AO's are associated with an atom labled A and B. 
\begin{align}
P_{\mu\nu} &= P^{(0)}_{\mu\nu}+ \delta P_{\mu\nu}\\
    P^{(0)}_{\mu\nu}&=\sum_j^{occ. MO}c_{\mu j}c_{j\nu}\\ 
    \delta P_{\mu\nu} &=??\quad\text{comes from the iteration, can be skipped for now}\\
\begin{split}
H^{EHT}_{\mu\nu} &= \frac{1}{2}K^{ll'}_{AB}S_{\mu\nu}(H_{\mu\mu}+H_{\nu\nu})\\&\cdot X(EN_A,EN_B)\\&\cdot \Pi(R_{AB},l,l')\\&\cdot Y(\zeta^A_l,\zeta^B_{l'}), \forall \mu \in l(A), \nu \in l'(B)
\end{split}
\end{align}
$K^{ll'}_{AB}$ is a element and shell specific fitted constant however, in GFN2 it only depends on the shells. 
$S_{\mu\nu}=\braket{\phi_\mu|\phi_\nu}$ is just the overlap of the orbitals. In GFN2 $H_{\kappa\kappa}=h^l_A-\delta h^l_{CN'_A}CN'_A$ where $CN'_A$ is the modified GFN2-type Coordinate Number for the element of atom A.

\begin{align}
\begin{split}
  CN^{'}_A = &\sum^{N_\text{atoms}}_{B \neq A} (1 + e^{-10(4(R_{A,\text{cov}} + R_{B,\text{cov}})/3R_{AB}-1)})^{-1} \\
             &\times (1 + e^{-20(4(R_{A,\text{cov}} + R_{B,\text{cov}} + 2)/3R_{AB}-1)})^{-1}
\end{split}
\end{align}

$h^l_A$ and $\delta h^l_{CN'_A}$ are both fitted constants. $EN_A$ is the electronegativity of the element of atom A. 

\begin{align}
    X(EN_A,EN_B) &= 1 + k_{EN}\Delta EN_{AB}^2\\
    k_{EN} &= 0.02 \text{ in GFN2}\\
    \Delta EN_{AB}^2 &= (EN_A-EN_B)^2  
\end{align}
The electronegativity for C and H are 2.55 and 2.20 according to wikipedia.
Thus here is a table for the combinations we will be working with:\\ 
\begin{tabular}{c|c|l}
    A&B&$X(EN_A,EN_B)$\\
    \hline
    C&C&$1$\\
    C&H&$1+0.02\cdot (0.35^2)$\\
    H&C&$1+0.02\cdot (0.35^2)$\\
    H&H&$1$\\
\end{tabular}
\begin{equation}
\begin{split}
    \Pi(R_{AB},l,l') &= \left(1 + k^{\text{poly}}_{A,l}\left(\frac{R_{AB}}{R_{\text{cov},AB}}\right)^\frac{1}{2}\right)\left(1 + k^{\text{poly}}_{B,l'}\left(\frac{R_{AB}}{R_{\text{cov},AB}}\right)^\frac{1}{2}\right)\\
\end{split}
\end{equation}
$R_{\text{cov},AB}$ are the summed covalent radii (\(R_{\text{cov},A} + R_{\text{cov},B}\)), e.g. $R_{\text{cov},H}=0.32$, $R_{\text{cov},C}=0.75$. $k^{\text{poly}}_{A,l}$ and $k^{\text{poly}}_{B,l'}$ are element and shell specific constants. 
\begin{equation}
\begin{split}
    Y(\zeta^A_l,\zeta^B_{l'}) &= \left(\frac{2\sqrt{\zeta^A_l\zeta^B_{l'}}}{\zeta^A_l+\zeta^B_{l'}}\right)^\frac{1}{2}\\
\end{split}
\end{equation}
Here, $\zeta^A_l$ are the STO exponents of the GFN2-xTB AO basis.\\
Slater Type Orbitals are defined as such: 
\begin{equation}
\chi_{\zeta,n,l,m}(r, \theta, \varphi) = NY_{l,m}(\theta, \varphi)r^{n-1}e^{-\zeta r}
\end{equation}
N is a normalisation constant, Y are spherical harmonic funtions, n, l, m are the quantum numbers for the AO. $r,\theta,\varphi$ are polar 3D coordinates. $\zeta$ determines the radial extent of the STO, a large value gives rise to a function that is "tight" around the nucleus and a small value gives a more "diffuse" function. This $\zeta$ is the one mentioned in the Y term of $\E{EHT}$ and is a value fitted when constructing the basis set, thus it is given to us.  

\subsection{Isotropic electrostatic and XC energy}
\subsubsection{Second order}
\begin{align}
    \E{\gamma} &= \frac{1}{2}\sum_{A,B}^{N_{atoms}}\sum_{l\in A}\sum_{l'\in B}q_lq_{l'}\gamma_{AB,ll'}\\
    \gamma_{AB,ll'} &= \frac{1}{\sqrt{R_{AB}^2+\eta^{-2}_{AB,ll'}}}\\
    \eta_{AB,ll'}&=\frac{1}{2}\left[\eta_A(1+k_A^l)+\eta_B(1+k_B^{l'})\right]
\end{align}
$q_l$ is a partial muliken charge. $\eta_A$ and $\eta_B$ are element-specific fit parameters, while $k_A^l$ and $k_B^{l'}$ are element-specific scaling factors for the individual shells ($k_A^l=0$ when $l=0$).
\begin{align}
    GAP_A &= \sum_{l \in A} q_l\\
    q_l &= \sum_{l'\in B}P_{ll'}S_{ll'} = GOP_l
\end{align}
\subsubsection{Third order}
\begin{equation}
\begin{split}
    \E{\Gamma}^{GFN2} &= \frac{1}{3}\sum_A^{N_{atoms}}\sum_{l\in A}(q_l)^3K^\Gamma_l\Gamma_A
\end{split}
\end{equation}
$K^\Gamma_l$ is a shell specific constant common for all elements and $\Gamma_A$ is an element specific constant. 
\subsection{Anisotropic electrostatic energy}
\begin{equation}
\begin{split}
    \E{AES} &= \E{q\mu}+\E{q\Theta} + \E{\mu\mu}\\
    &= \frac{1}{2}\sum_{A,B}\{f_3(R_{AB})[q_A(\pmb{\mu}_B^T\pmb{R}_{BA})+q_B(\pmb{\mu}_A^T\pmb{R}_{AB})]\\
    &\quad + f_5(R_{AB})[q_A\pmb{R}_{AB}^T\pmb{\Theta}_B\pmb{R}_{AB}+q_B\pmb{R}_{AB}^T\pmb{\Theta}_A\pmb{R}_{AB}\\
    &\quad -3(\pmb{\mu}_A^T\pmb{R}_{AB})(\pmb{\mu}_B^T\pmb{R}_{AB}) + (\pmb{\mu}_A^T\pmb{\mu}_B)R_{AB}^2] \}\\
\end{split}
\end{equation}
$\pmb{\mu}_A$ is the cumulative atomic dipole moment of atom A and $\pmb{\Theta}_A$ is the corresponding traceless quadrupole moment. Traceless simply means that the sum of the diagonal elements is 0. The curly braces and brackets are used in the same way as normal parenthesis for showing order of operations. $q_A$ is the atomic charge of atom A. 
\begin{align}
    \Theta_A^{\alpha\beta} &= \frac{3}{2} \theta_A^{\alpha\beta} - \frac{\delta_{\alpha\beta}}{2} \left( \theta_A^{xx} + \theta_A^{yy} + \theta_A^{zz} \right)\\
    \theta_A^{\alpha\beta} &= \sum_{l' \in A} \sum_{l} P_{l} \left( \alpha_A D_{ll'}^{\beta} + \beta_A D_{ll'}^{\alpha} - \alpha_A \beta_A S_{ll'} - Q_{ll'}^{\alpha\beta} \right)\\
    q_A &= Z_A - GAP_A\\
    \mu_A^{\alpha} &= \sum_{l' \in A} \sum_{l} P_{l'l} \left( \alpha_A S_{l'l} - D_{l'l}^{\alpha} \right)\\
D_{ll'}^{\alpha} &= \braket{ \phi_{l} | \alpha_i | \phi_{l'}}\\
Q_{ll'}^{\alpha\beta} &= \braket{ \phi_{l} | \alpha_i\beta_i | \phi_{l'}}
\end{align}
$\alpha$ and $\beta$ are Cartesian components labled $(x,y,z)^T$ with atom A being centered in $v_A = (x_i,y_i,y_z)^T$ where i is a form of pointer/label dereferencing. $\delta_{\alpha\beta}$ is just the delta function, i.e is is 1 if $\alpha$ and $\beta$ are the same label and 0 otherwise, this serves to include the term only for the diagonal. 

\begin{equation}
    \pmb{\Theta}_A = 
    \begin{pmatrix}
        \Theta_A^{xx} & \Theta_A^{xy} & \Theta_A^{xz}\\
        \Theta_A^{yx} & \Theta_A^{yy} & \Theta_A^{yz}\\
        \Theta_A^{zx} & \Theta_A^{zy} & \Theta_A^{zz}\\
    \end{pmatrix}
\end{equation}
\begin{equation}
    \pmb{\mu}_A = 
    \begin{pmatrix}
        \mu_A^{x}\\
        \mu_A^{y}\\
        \mu_A^{z}\\
    \end{pmatrix}
\end{equation}
\begin{equation}
    \pmb{R}_{AB} = v_A-v_B
\end{equation}


\begin{align}
    f_n(R_{AB}) &= \frac{f_{damp}(a_n,R_{AB})}{R_{AB}^n}=\frac{1}{R_{AB}^n}\frac{1}{1+6\left(\frac{R_0^{AB}}{R_{AB}}\right)^{a_n}}\\
    R_0^{AB} &= 0.5 ({R^A_0}'+ {R^B_0}')\\
    {R^A_0}' &= \begin{cases}R^A_0 + \frac{R_{max}-R^A_0}{1+exp[-4(CN_A'-N_{val}-\Delta_{val})]} & \text{if }N_{val}\text{ is given}\\5.0 \text{ bohrs} & \text{otherwise}\end{cases}\\
        R_{max} &= 5.0 \text{ bohrs}\\
    \Delta_{val} &= 1.2
\end{align}
$R_0^A$ is a fitted value for 12 elements and 5.0 for the rest. $a_n$ are adjusted global parameters. 



\subsection{Anisotropic XC energy}
\begin{equation}
    \E{AXC} = \sum_A (f^{\mu_A}_{XC}|\pmb{\mu}_A|^2 + f^{\Theta_A}_{XC}||\pmb{\Theta}_A||^2)
\end{equation}
Where $f^{\mu_A}_{XC}$ and $f^{\Theta_A}_{XC}$ are fitted values. What norms are these?

\newpage

\subsection{Dispersion Energy}
\begin{equation}
\begin{split}
  \E{disp}^{D4'} = &-\sum_{A>B} \sum_{n=6,8} s_n \frac{C_n^{AB} (q_A, CN^A_{cov}, q_B, CN^B_{cov})}{R^n_{AB}} f^{(n)}_{damp,BJ} (R_{AB}) \\
  &-s_9 \sum_{A>B>C} \frac{(3cos(\theta_{ABC})cos(\theta_{BCA})cos(\theta_{CAB})+1)C_9^{ABC}(CN_{cov}^A,CN_{cov}^B,CN_{cov}^C)}{(R_{AB} R_{AC} R_{BC})^3} \\
  &\times f^{(9)}_{damp,zero}(R_{AB},R_{AC},R_{BC}).
\end{split}
\end{equation}

\vspace{10pt}
\noindent
The term in the second line is the three-body Axilrod–
Teller–Muto (ATM) (What is this??????) term and the last line is the corresponding zero-damping function for this term.


\vspace{10pt}
\noindent
\(C_6^{AB}\) is the pairwise dipole-dipole dispersion coefficients calculated by numerical integration via the Casimir-Polder relation.
\begin{equation}
  C_6^{AB} = \frac{3}{\pi} \sum_{j} w_j \overline{\alpha}_A (i\omega_j, q_A, CN_{cov}^A)\overline{\alpha}_B (i\omega_j, q_B, CN_{cov}^B)
\end{equation}

\noindent
\(w_j\) are the integration weights, which are derived from a trapeziodal partitioning between the grid points \(j(j \in [1,23])\).

\noindent
The isotropically averaged, dynamic dipole-dipole polarizabilites \(\overline{\alpha}\) at the \(j\)th imaginary frequency \(i\omega_j\) are obtained from the self-consistent D4 model; i.e., they are depending on the covalent coordination number and are also charge dependent.

\begin{equation}
  \overline{\alpha}_A(i\omega_j, q_A, CN_{cov}^A) = \sum_{r}^{N_{A,ref}} \xi_A^r (q_A, q_{A,r}) \overline{\alpha}_{A,r}(i\omega_j, q_{A,r}, CN_{cov}^{A,r}) W_A^r(CN_{cov}^A, CN_{cov}^{A,r})
\end{equation}

\noindent
The Gaussian weighting for each reference system is given by:
\begin{equation}
  W_A^r(CN_{cov}^A, CN_{cov}^{A,r}) = \sum_{j=1}^{N_{gauss}} \frac{1}{\mathcal{N}} \exp\left[-6j \cdot (CN_{cov}^A - CN_{cov}^{A,r})^2\right]
\end{equation}

with
\begin{equation}
  \sum_{r}^{N_{A,ref}} W_A^r(CN_{cov}^A, CN_{cov}^{A,r}) = 1
\end{equation}

\vspace{10pt}
\noindent
\(\mathcal{N}\) is a normalization constant.

\noindent
The number of Gaussian function per reference system \(N_{gauss}\) is mostly one, but equal to three for \(CN_{cov}^{A,r} = 0\) and reference systems with similar coordination number.

\noindent
The carge-dependency is included via the empirical scaling function \(\xi_A^r\).
\begin{equation}
  \xi_A^r(q_A, q_{A,r}) = \exp\left[3\left\{1-\exp\left[4\eta_A\left(1-\frac{Z_A^{eff} + q_{A,r}}{Z_A^{eff} + q_A}\right)\right]\right\}\right]
\end{equation}

\noindent
where \(\eta_A\) is the chemical hardness taken from ref 98.

\noindent
\(Z_A^{eff}\) is the effective nuclear charge of atom A, which has been determined by subtracting the number of core electrons represented by the def2-ECPs in the time-dependent DFT reference calculations.



\vspace{10pt}
\noindent
\(C_8^{AB}\) is calculated recursively from the lowest order \(C_6^{AB}\) coefficients.

\begin{equation}
  C_8^{AB} = 3C_6^{AB} \sqrt{\mathcal{Q}^A\mathcal{Q}^B}
\end{equation}

\begin{equation}
  \mathcal{Q}^A = s_{42} \sqrt{Z^A} \frac{\braket{r^4}^A}{\braket{r^2}^A}
\end{equation}


\vspace{10pt}
\noindent
\(\sqrt{Z^A}\) is the ad hoc nuclear charge dependent factor.

From the original xTB program we can see that \(s_{42}\) is \(0.5\), and \(Z^A\) is the atomic number of A.

\begin{equation}
  \sqrt{0.5 * (\frac{r^4}{r^2} * \sqrt{Z^A})}
\end{equation}


\(\braket{r4}\) and \(\braket{r2}\) are simple multipole-type expectation values derived from atomic densities which are averaged geometrically to get the pair coefficients. (What is 'r', how we get??????) (what is \(s_{42}\)???)

\vspace{20pt}
\noindent
\(CN^A_{cov}\) is the covalent coordination number for atom A.

\vspace{10pt}
\noindent
\(q\) is the atomic charge, so \(q_A\) is the atomic charge for atom A.

\vspace{10pt}
\noindent
The damping and scaling parameters in the
dispersion model are:
\[
  a1 = 0.52 \quad|\quad a2 = 5.0 \quad|\quad s6 = 1.0 \quad|\quad s8 = 2.7 \quad|\quad s9 = 5.0
\]


\vspace{10pt}
\noindent
\(C_9^{ABC}\) is the triple-dipole constant\footnote{\label{dft-d}https://www.researchgate.net/publication/43347348\_A\_Consistent\_and\_Accurate\_Ab\_Initio\_Parametrization\_of\_Density\_Functional\_Dispersion\_Correction\_DFT-D\_for\_the\_94\_Elements\_H-Pu}:
\begin{equation}
  C_9^{ABC} = \frac{3}{\pi} \int_0^\infty \alpha^A(i\omega) \alpha^B(i\omega)\alpha^C(i\omega)d\omega
\end{equation}


\vspace{10pt}
\noindent
The three-body contribution is typically \(<5-10\%\) of \(E_{disp}\), so it is small enough that we can reasonably approximate the coefficients by a geometric mean as\footnoteref{dft-d}:

\begin{equation}
  C_9^{ABC} \approx -\sqrt{C_6^{AB} C_6^{AC} C_6^{BC}}
\end{equation}


\vspace{10pt}
\noindent
\(\theta_{ABC}\) is the angle between the two edges going from B to the other two atoms. \(\theta_{BCA}\) is the angle between the edges going from C to the other two and so on.


\vspace{10pt}
\noindent
BJ = Becke-Johnson

\begin{equation}
  f_n^{damp,BJ}(R_{AB}) = \frac{R_{AB}^n}{R_{AB}^n + (a_1 \cdot R_{AB}^{crit} + a_2)^6}
\end{equation}

\begin{equation}
  R_{AB}^{crit} = \sqrt{\frac{C_8^{AB}}{C_6^{AB}}}
\end{equation}


\begin{equation}
  f_9^{damp,zero}(R_{AB}, R_{AC}, R_{BC}) = \left(1 + 6 \left(\sqrt{\frac{R_{AB}^{crit} R_{BC}^{crit} R_{CA}^{crit}}{R_{AB} R_{BC} R_{CA}}}\right)^{16}\right)^{-1}
\end{equation}



\subsection{SAD - Superposition of Atomic Densities}

The superposition of atomic densities(SAD) is an approach to obtain a good approximation of a collection of atoms, to be used as an initial guess for solving the self-consistent field(SCF) equation.

As originally implemented in DISCO, the molecular electron density can be obtained by adding the densities of all the constituting atoms.


%https://pyscf.org/user/scf.html#initial-guess
%https://sci-hub.box/10.1002/jcc.20393

This is how we get the density matrix for an isolated atom? equation 15 from: (https://sci-hub.box/10.1002/jcc.540030314)
\begin{equation}
  D_{ij} = \sum_a^{occ} c_{ia} c_{ja}
\end{equation}

To get the coefficients we need to solve SCF for each atom? this is supposedly cheap, but idk how to do it. (https://sci-hub.box/10.1002/jcc.20393)
Though the math for Direct SCF Approach is given in this paper at equation 10: (https://sci-hub.box/10.1002/jcc.540030314). This is probably how.

The SAD method is then the sum of all of these?

Equation 3 in the GFN2 paper talks about "superposition of (neutral) atomic reference densities". Is this relevant?

Direct SCF Approach
\begin{equation}
\begin{split}
  \Delta F_{ab} = &(c_{ia}c_{jb} + c_{ja}c_{ib})\\
  &\Delta F_{ij} + (c_{ia}c_{kb} + c_{ka}c_{ib})\\
  &\Delta F_{ik} + (c_{ia}c_{lb} + c_{la}c_{ib})\\
  &\Delta F_{il} + (c_{ja}c_{kb} + c_{ka}c_{jb})\\
  &\Delta F_{jk} + (c_{ja}c_{lb} + c_{la}c_{jb})\\
  &\Delta F_{jl} + (c_{ka}c_{lb} + c_{la}c_{kb}) \Delta F_{kl}\\
  &= l_{ijkl}(4E_{ij}^{ab}D_{kl} + 4D_{ij}E_{kl}^{ab} - E_{ik}^{ab}D_{jl} - D_{ik}E_{jl}^{ab} - E_{il}^{ab}D_{jk} - D_{il}E_{jk}^{ab})
\end{split}
\end{equation}
where
\begin{equation}
  E_{ij}^{ab} = c_{ia}c_{jb} + c_{ja}c_{ib}
\end{equation}




\end{document}
